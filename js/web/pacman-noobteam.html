<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>
		function checkKey(e){
		var key=0;
			key=String.fromCharCode(e.keyCode);
			if(key=="&"){key="arrowup"}
			if(key=="%"){key="arrowleft"}
			if(key=="("){key="arrowdown"}
			if(key=="'"){key="arrowright"}
			if(key==" "){key="space"}
			if(key==""){key="ctrl"}
			if(key==""){key="alt"}
			if(key==""){key="capLocks"}
			if(key==""){key="shift"}
			return(key);
	}
	
	</script>
    <script>
		
		var stageDimension=10;
		var stageBlockWidth=30;
		var stageBlockMargin=5;
		var stageArray= new Array(stageDimension);
		var playersArray=new Array();
		
		var actionLeft=false;
		var actionRigth=false;
		var actionUp=false;
		var actionDown=false;
		
		window.onload = function(){
		 console.log("Pacman-Multiplayer");
		
		
		for(var i=0;i<3;i++){
			playersArray.push(new Player(Math.round(Math.random()*(stageDimension-1)),Math.round(Math.random()*(stageDimension-1)),"player1"+i));
		}
		
		createStage();
		
		$(window).keyup(function(e){
			setActions(e);
		});

		function createStage(){
			for(var i=0;i<stageDimension;i++){
					stageArray[i]=new Array(stageDimension);
				for(var ii=0;ii<stageDimension;ii++){
					if( i<5 || i>5  || ii<1 || ii>stageDimension-2){
						stageArray[i][ii]=new Block(true);
					}else{
						stageArray[i][ii]=new Block(false);
					}
				}
			}
			
			drawStage();
		}
		
		function drawStage(){
			console.log("DrawingStage");
			for(var i=0;i<stageDimension;i++){
				for(var ii=0;ii<stageDimension;ii++){
					if(stageArray[i][ii].state){
					$("#stage-container").append('<div class="stage-block" style="position: absolute; top:'+stageBlockWidth*i+'px; left:'+stageBlockWidth*ii+'px; width:'+stageBlockWidth+'px; height:'+stageBlockWidth+'px; background-color: grey;"></div>');
					}else{
					$("#stage-container").append('<div class="stage-block" style="position: absolute; top:'+stageBlockWidth*i+'px; left:'+stageBlockWidth*ii+'px; width:'+stageBlockWidth+'px; height:'+stageBlockWidth+'px; background-color: black;"></div>');}
				}
			}
			drawPlayers();
		   
		}
		
		function drawPlayers(){
			for(var i=0;i<playersArray.length;i++){
				  $("#stage-container").append('<div id="'+playersArray[i].id+'" style="position: absolute; top:'+stageBlockWidth*playersArray[i].posy+'px; left:'+stageBlockWidth*playersArray[i].posx+'px; width:'+stageBlockWidth+'px; height:'+stageBlockWidth+'px; background-color: red;"></div>');
			}
		}
		
		
		
		setInterval(animatePlayer,100);
		
		
		var posx;
		var posy;
		function animatePlayer(){
			 for(var i=0;i<playersArray.length;i++){
				 $("#"+playersArray[i].id).css('left',playersArray[i].posx*stageBlockWidth);
				 $("#"+playersArray[i].id).css('top',playersArray[i].posy*stageBlockWidth);
				 
				 posx=playersArray[i].posx;
				 posy=playersArray[i].posy;
				 
				 if(actionRigth && playersArray[i].posx<stageDimension-1){
				 playersArray[i].posx++;}
				 
				 if(actionLeft && playersArray[i].posx>=1){          
				 playersArray[i].posx--;}
				 
				 if(actionUp && playersArray[i].posy>0 && posy-1>=0 && stageArray[posx][posy-1].state ){
					 playersArray[i].posy--;
				 }
				 
				 if(actionDown && playersArray[i].posy<stageDimension-1 ){          
				 playersArray[i].posy++;}
				 

			 }
		}

	}
	
	function setActions(e){
			actionsFalse();
			console.log("movement");
			key=e; 
			if(key=="arrowup"){
				actionUp=true;   
			}
			if(key=="arrowdown"){
				actionDown=true;   
			}
			if(key=="arrowleft"){
				actionLeft=true;   
			}
			if(key=="arrowright"){
				actionRigth=true;   
			}
			movePlayer();
		}
		
		
		
		function actionsFalse(){
			actionDown=false;
			actionLeft=false;
			actionRigth=false;
			actionUp=false;
		}

	function Block(state){
		this.state=state;   
	}


	function Player(posx,posy,id){
		this.posx=posx;
		this.posy=posy;
		this.id=id;
	}
	
	</script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
	  var socket = io.connect('http://192.168.15.117');
	  socket.on('doSomething', function (data) {
		console.log(data);
		window.setActions('arrowup');
	  });
	</script>
    </head>
    <body>
        <section>
            <div id="stage-container">
            
            </div>
        </section>
    </body>
</html>